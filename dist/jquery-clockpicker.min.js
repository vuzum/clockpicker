/*!
 * ClockPicker v0.0.7 (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */
!function(t){function i(t){return document.createElementNS(c,t)}function e(t){return(10>t?"0":"")+t}function s(t){var i=++d+"";return t?t+i:i}function o(o,c){function a(t,i){var e=k.offset(),s=/^touch/.test(t.type),o=e.left+v,n=e.top+v,c=(s?t.originalEvent.touches[0]:t).pageX-o,a=(s?t.originalEvent.touches[0]:t).pageY-n,u=Math.sqrt(c*c+a*a),h=!1;if(!i||!(f-m>u||u>f+m)){t.preventDefault();var d=setTimeout(function(){P.$body.addClass("clockpicker-moving")},200);r&&k.append(P.canvas),P.setHand(c,a,!i,!0),P.$doc.off(l).on(l,function(t){t.preventDefault();var i=/^touch/.test(t.type),e=(i?t.originalEvent.touches[0]:t).pageX-o,s=(i?t.originalEvent.touches[0]:t).pageY-n;(h||e!==c||s!==a)&&(h=!0,P.setHand(e,s,!1,!0))}),P.$doc.off(p).on(p,function(t){P.$doc.off(p),t.preventDefault();var e=/^touch/.test(t.type),s=(e?t.originalEvent.changedTouches[0]:t).pageX-o,r=(e?t.originalEvent.changedTouches[0]:t).pageY-n;(i||h)&&s===c&&r===a&&P.setHand(s,r),"hours"===P.currentView&&P.toggleView("minutes",w/2),P.done(),k.prepend(B),clearTimeout(d),P.$body.removeClass("clockpicker-moving"),P.$doc.off(l)})}}var u=t(y),k=u.find(".clockpicker-plate"),d=k.find(".clockpicker-hours"),M=k.find(".clockpicker-minutes"),A=k.find(".clockpicker-am-pm-block"),V="INPUT"===o.prop("tagName"),T=V?o:o.find("input"),P=this;if(this.$doc=t(o.get(0).ownerDocument),this.$body=this.$doc.find("body"),this.id=s("cp"),this.element=o,this.options=c,this.currentView="hours",this.isInput=V,this.input=T,this.wrapper=u,this.plate=k,this.hoursView=d,this.minutesView=M,this.amPmBlock=A,this.amOrPm="PM",c.twelvehour){{var C=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");t(C)}t('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){P.amOrPm="AM",t(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),t('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){P.amOrPm="PM",t(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}var D,H,E,I,$=t('<div class="clockpicker-tick"></div>');if(c.twelvehour)for(D=1;13>D;D+=1)H=$.clone(),E=D/6*Math.PI,I=f,H.addClass("inner"),H.css({left:v+Math.sin(E)*I-m,top:v-Math.cos(E)*I-m}),H.html(0===D?"00":D),d.append(H),H.on(h,a);else for(D=0;24>D;D+=1){H=$.clone(),E=D/6*Math.PI;var x=D>0&&13>D;I=x?b:f,H.css({left:v+Math.sin(E)*I-m,top:v-Math.cos(E)*I-m}),x&&H.addClass("inner"),H.html(0===D?"00":D),d.append(H),H.on(h,a)}for(D=0;60>D;D+=5)H=$.clone(),E=D/30*Math.PI,H.css({left:v+Math.sin(E)*f-m,top:v-Math.cos(E)*f-m}),H.html(e(D)),M.append(H),H.on(h,a);if(k.on(h,function(i){0===t(i.target).closest(".clockpicker-tick").length&&a(i,!0)}),r){var B=k.find(".clockpicker-canvas"),S=i("svg");S.setAttribute("class","clockpicker-svg"),S.setAttribute("width",g),S.setAttribute("height",g);var O=i("g");O.setAttribute("transform","translate("+v+","+v+")");var U=i("circle");U.setAttribute("class","clockpicker-canvas-bearing"),U.setAttribute("cx",0),U.setAttribute("cy",0),U.setAttribute("r",2);var j=i("line");j.setAttribute("x1",0),j.setAttribute("y1",0);var L=i("circle");L.setAttribute("class","clockpicker-canvas-bg"),L.setAttribute("r",m);var N=i("circle");N.setAttribute("class","clockpicker-canvas-fg"),N.setAttribute("r",3.5),O.appendChild(j),O.appendChild(L),O.appendChild(N),O.appendChild(U),S.appendChild(O),B.append(S),this.hand=j,this.bg=L,this.fg=N,this.bearing=U,this.g=O,this.canvas=B}this.init(),n(this.options.init)}function n(t,i,e){t&&"function"==typeof t&&(i&&!Array.isArray(i)&&(i=[i]),t.apply(e,i))}var c=(t(window),"http://www.w3.org/2000/svg"),r="SVGAngle"in window&&function(){var t,i=document.createElement("div");return i.innerHTML="<svg/>",t=(i.firstChild&&i.firstChild.namespaceURI)==c,i.innerHTML="",t}(),a=function(){var t=document.createElement("div").style;return"transition"in t||"WebkitTransition"in t||"MozTransition"in t||"msTransition"in t||"OTransition"in t}(),u="ontouchstart"in window,h="mousedown"+(u?" touchstart":""),l="mousemove.clockpicker"+(u?" touchmove.clockpicker":""),p="mouseup.clockpicker"+(u?" touchend.clockpicker":""),k=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,d=0,v=80,f=64,b=43.2,m=13,g=2*v,w=a?350:1,y=['<div class="clockpicker-wrapper" style="position: relative;">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</div>"].join("");o.DEFAULTS={"default":"",fromnow:0,align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},o.prototype.init=function(){this.element.after(this.wrapper);var t=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if("now"===t[0]){var i=new Date(+new Date+this.options.fromnow);t=[i.getHours(),i.getMinutes()]}this.hours=+t[0]||0,this.minutes=+t[1]||0,this.toggleView("hours")},o.prototype.toggleView=function(i,e){var s=!1;null==i&&(i="hours"===this.currentView?"minutes":"hours"),"minutes"===i&&"visible"===t(this.hoursView).css("visibility")&&(n(this.options.beforeHourSelect),s=!0);var o="hours"===i,c=o?this.hoursView:this.minutesView,r=o?this.minutesView:this.hoursView;this.currentView=i,r.addClass("clockpicker-dial-out"),c.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(e),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){r.css("visibility","hidden")},w),s&&n(this.options.afterHourSelect),n(this.options.afterViewToggle,i)},o.prototype.resetClock=function(t){var i=this.currentView,e=this[i],s="hours"===i,o=Math.PI/(s?6:30),n=e*o,c=s&&e>0&&13>e?b:f,a=Math.sin(n)*c,u=-Math.cos(n)*c,h=this;r&&t?(h.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){h.canvas.removeClass("clockpicker-canvas-out"),h.setHand(a,u)},t)):this.setHand(a,u)},o.prototype.setHand=function(i,s,o,c){var a,u=Math.atan2(i,-s),h="hours"===this.currentView,l=Math.PI/(h||o?6:30),p=Math.sqrt(i*i+s*s),d=this.options,v=h&&(f+b)/2>p,m=v?b:f;if(d.twelvehour&&(m=f),0>u&&(u=2*Math.PI+u),a=Math.round(u/l),u=a*l,d.twelvehour?h?0===a&&(a=12):(o&&(a*=5),60===a&&(a=0)):h?(12===a&&(a=0),a=v?0===a?12:a:0===a?0:a+12):(o&&(a*=5),60===a&&(a=0)),this[this.currentView]!==a&&k&&this.options.vibrate&&(this.vibrateTimer||(navigator[k](10),this.vibrateTimer=setTimeout(t.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=a,n(this.options.clockUpdate,[this.currentView,e(a)]),!r)return this[h?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var i=t(this);i.toggleClass("active",a===+i.html())}),void 0;c||!h&&a%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var g=Math.sin(u)*m,w=-Math.cos(u)*m;this.hand.setAttribute("x2",g),this.hand.setAttribute("y2",w),this.bg.setAttribute("cx",g),this.bg.setAttribute("cy",w),this.fg.setAttribute("cx",g),this.fg.setAttribute("cy",w)},o.prototype.done=function(){n(this.options.beforeDone);var t=this.input.prop("value"),i=e(this.hours)+":"+e(this.minutes);this.options.twelvehour&&(i+=this.amOrPm),this.input.prop("value",i),i!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),n(this.options.afterDone)},o.prototype.refresh=function(){var t=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if("now"===t[0]){var i=new Date(+new Date+this.options.fromnow);t=[i.getHours(),i.getMinutes()]}this.hours=+t[0]||0,this.minutes=+t[1]||0},o.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker")},t.fn.clockpicker=function(i){var e=Array.prototype.slice.call(arguments,1);return this.each(function(){var s=t(this),n=s.data("clockpicker");if(n)n.refresh(),"function"==typeof n[i]&&n[i].apply(n,e);else{var c=t.extend({},o.DEFAULTS,s.data(),"object"==typeof i&&i);s.data("clockpicker",new o(s,c))}})}}(jQuery);